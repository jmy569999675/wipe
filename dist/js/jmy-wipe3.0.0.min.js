/*! jmy-wipe - v3.0.0 - 2018-11-19 */
function Wipe(t){this.coverType=t.coverType,this.coverTypeValue="color"===t.coverType?t.color:t.imgUrl,this.conID=t.id,this.cas=document.getElementById(this.conID),this.context=cas.getContext("2d"),this._w=t.width,this._h=t.height,this.radius=t.radius,this.lock=!1,this.posY=null,this.posX=null,this.background=t.url,this.cas.setAttribute("width",this._w),this.cas.setAttribute("height",this._h),this.cas.style.background="url("+this.background+") 0 0 no-repeat",this.percent1=t.percent,this.drawMask(),this.incident()}Wipe.prototype.drawT=function(t,e,i,o){if(this.context.save(),this.context.beginPath(),2===arguments.length)this.context.arc(t-getAllOffsetLeft(cas),e-getAllOffsetTop(cas),this.radius,0,2*Math.PI),this.context.globalCompositeOperation="destination-out",this.context.fill(),this.context.save();else{if(4!==arguments.length)return!1;this.context.lineCap="round",this.context.lineWidth=2*this.radius,this.context.moveTo(t-getAllOffsetLeft(cas),e-getAllOffsetTop(cas)),this.context.lineTo(i-getAllOffsetLeft(cas),o-getAllOffsetTop(cas))}this.context.stroke(),this.context.restore()},Wipe.prototype.drawMask=function(){this.context.beginPath();var t=this;if("color"===this.coverType)this.context.fillStyle=this.coverTypeValue||"#666",this.context.fill(),this.context.fillRect(0,0,this._w,this._h);else if("image"===this.coverType){var e=new Image;e.src=this.coverTypeValue,e.onload=function(){t.context.drawImage(e,0,0,t._w,t._h,0,0,t._w,t._h)}}this.context.stroke(),this.context.restore()},Wipe.prototype.clearRect=function(){this.context.clearRect(0,0,this._w,this._h)},Wipe.prototype.getTransparencyPercent=function(){for(var t=this.context.getImageData(0,0,this._w,this._h),e=0,i=0;i<t.data.length;i+=4){0===t.data[i+3]&&e++}return this.percent=e/(this._w*this._h)*100,Math.round(Math.ceil(this.percent))};var device=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()),down=device?"touchstart":"mousedown",move=device?"touchmove":"mousemove",end=device?"touchend":"mouseup";function getAllOffsetLeft(t){for(var e=0;t;)e+=t.offsetLeft,t=t.offsetParent;return e}function getAllOffsetTop(t){for(var e=0;t;)e+=t.offsetTop,t=t.offsetParent;return e}Wipe.prototype.incident=function(){var s=this;cas.addEventListener(down,function(t){var e=t||window.event;s.posY=device?e.touches[0].clientY:e.clientY,s.posX=device?e.touches[0].clientX:e.clientX,s.drawT(s.posX,s.posY),s.lock=!0},!1),cas.addEventListener(move,function(t){if(!0!==s.lock)return!1;var e=t||window.event;e.preventDefault();var i=device?e.touches[0].clientX:e.clientX,o=device?e.touches[0].clientY:e.clientY;s.drawT(s.posX,s.posY,i,o),s.posX=i,s.posY=o},!1),cas.addEventListener(end,function(t){s.lock=!1,s.getTransparencyPercent()>=s.percent1&&(console.log("大于"+s.percent1+"%面积"),wipeCallback(s.getTransparencyPercent()),s.clearRect(s.context))},!1)};