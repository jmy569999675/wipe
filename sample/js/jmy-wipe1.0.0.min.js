/*! jmy-wipe - v1.0.0 - 2018-11-14 */
var posY,posX,cas=document.querySelector("#cas"),context=cas.getContext("2d"),_w=cas.width,_h=cas.height,radius=20,lock=!1,device=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()),down=device?"touchstart":"mousedown",move=device?"touchmove":"mousemove",end=device?"touchend":"mouseup";function drawMask(e){e.beginPath(),e.fillStyle="#666",e.fill(),e.fillRect(0,0,_w,_h),e.stroke(),e.restore()}function drawAll(e,t,o,n,c){if(e.save(),e.beginPath(),3===arguments.length)e.arc(t,o,radius,0,2*Math.PI),e.globalCompositeOperation="destination-out",e.fill(),e.save();else{if(5!==arguments.length)return!1;e.lineCap="round",e.lineWidth=2*radius,e.moveTo(t,o),e.lineTo(n,c)}e.stroke(),e.restore()}function clearRect(e){e.clearRect(0,0,_w,_h)}function getTransparencyPercent(e){for(var t=e.getImageData(0,0,_w,_h),o=0,n=0;n<t.data.length;n+=4){0===t.data[n+3]&&o++}var c=o/(_w*_h)*100;return Math.round(Math.ceil(c))}cas.addEventListener(down,function(e){var t=e||window.event;posY=device?t.touches[0].clientY:t.clientY,posX=device?t.touches[0].clientX:t.clientX,drawAll(context,posX,posY),lock=!0},!1),cas.addEventListener(move,function(e){if(!0!==lock)return!1;var t=e||window.event;t.preventDefault();var o=device?t.touches[0].clientX:t.clientX,n=device?t.touches[0].clientY:t.clientY;drawAll(context,posX,posY,o,n),posX=o,posY=n},!1),cas.addEventListener(end,function(e){lock=!1,50<=getTransparencyPercent(context)&&(console.log("大于50%面积"),clearRect(context))},!1),window.onload=function(){drawMask(context)};